# 如何从 0 到 1 搭建前端基建？（了解）

**题目**: 如何从 0 到 1 搭建前端基建？（了解）

## 标准答案

搭建前端基建需要从项目初始化开始，包括：项目脚手架搭建、构建工具配置、代码规范制定、组件库设计、状态管理、路由管理、API 管理、测试体系、部署流程等。核心是建立一套标准化、可复用、可维护的开发流程和工具链，提升开发效率和代码质量。

## 详细解析

### 1. 项目初始化与脚手架

前端基建的第一步是建立项目脚手架，包括：
- 项目结构设计
- 依赖管理配置
- 开发环境搭建
- 基础模板创建

### 2. 构建工具配置

构建工具是前端基建的核心，主要包括：
- Webpack/Vite/Rollup 配置
- 模块打包与优化
- 开发服务器配置
- 生产环境构建优化

### 3. 代码规范体系

建立统一的代码规范，包括：
- ESLint 代码检查
- Prettier 代码格式化
- Stylelint CSS 检查
- Git Hooks 预提交检查

### 4. 组件库与设计系统

构建可复用的组件库：
- 原子化组件设计
- 主题定制能力
- 文档生成系统
- 组件测试体系

### 5. 开发流程优化

- 自动化测试体系
- CI/CD 流程
- 代码审查机制
- 版本发布管理

## 代码示例

### 1. 项目脚手架搭建

```json
{
  "name": "frontend-infrastructure",
  "version": "1.0.0",
  "description": "前端基建项目模板",
  "scripts": {
    "dev": "vite",
    "build": "vite build",
    "preview": "vite preview",
    "lint": "eslint src --ext .js,.ts,.jsx,.tsx",
    "lint:fix": "eslint src --ext .js,.ts,.jsx,.tsx --fix",
    "format": "prettier --write \"src/**/*.{js,ts,jsx,tsx,css,md}\"",
    "test": "jest",
    "test:watch": "jest --watch",
    "test:coverage": "jest --coverage",
    "prepare": "husky install"
  },
  "dependencies": {
    "react": "^18.2.0",
    "react-dom": "^18.2.0",
    "react-router-dom": "^6.8.1",
    "redux": "^4.2.1",
    "@reduxjs/toolkit": "^1.9.3"
  },
  "devDependencies": {
    "@types/react": "^18.0.28",
    "@types/react-dom": "^18.0.11",
    "@vitejs/plugin-react": "^3.1.0",
    "vite": "^4.2.0",
    "eslint": "^8.36.0",
    "prettier": "^2.8.4",
    "husky": "^8.0.3",
    "lint-staged": "^13.2.0",
    "jest": "^29.5.0",
    "@testing-library/react": "^14.0.0"
  }
}
```

### 2. Vite 构建配置

```javascript
// vite.config.js
import { defineConfig } from 'vite';
import react from '@vitejs/plugin-react';
import { resolve } from 'path';

export default defineConfig({
  plugins: [react()],
  
  resolve: {
    alias: {
      '@': resolve(__dirname, 'src'),
      '@components': resolve(__dirname, 'src/components'),
      '@utils': resolve(__dirname, 'src/utils'),
      '@assets': resolve(__dirname, 'src/assets'),
      '@api': resolve(__dirname, 'src/api'),
      '@store': resolve(__dirname, 'src/store'),
      '@hooks': resolve(__dirname, 'src/hooks'),
      '@services': resolve(__dirname, 'src/services')
    }
  },
  
  server: {
    host: '0.0.0.0',
    port: 3000,
    open: true,
    proxy: {
      '/api': {
        target: 'http://localhost:8080',
        changeOrigin: true,
        rewrite: (path) => path.replace(/^\/api/, '')
      }
    }
  },
  
  build: {
    outDir: 'dist',
    assetsDir: 'assets',
    sourcemap: false,
    minify: 'terser',
    terserOptions: {
      compress: {
        drop_console: true,
        drop_debugger: true
      }
    },
    rollupOptions: {
      output: {
        manualChunks: {
          vendor: ['react', 'react-dom'],
          router: ['react-router-dom'],
          redux: ['@reduxjs/toolkit', 'react-redux']
        }
      }
    }
  },
  
  css: {
    preprocessorOptions: {
      scss: {
        additionalData: `@import "@/styles/variables.scss";`
      }
    }
  }
});
```

### 3. ESLint 配置

```javascript
// .eslintrc.js
module.exports = {
  env: {
    browser: true,
    es2021: true,
    node: true,
    jest: true
  },
  extends: [
    'eslint:recommended',
    '@typescript-eslint/recommended',
    'plugin:react/recommended',
    'plugin:react-hooks/recommended',
    'plugin:import/errors',
    'plugin:import/warnings'
  ],
  parser: '@typescript-eslint/parser',
  parserOptions: {
    ecmaFeatures: {
      jsx: true
    },
    ecmaVersion: 'latest',
    sourceType: 'module'
  },
  plugins: [
    'react',
    '@typescript-eslint',
    'import'
  ],
  settings: {
    react: {
      version: 'detect'
    }
  },
  rules: {
    'react/react-in-jsx-scope': 'off',
    'react/prop-types': 'off',
    '@typescript-eslint/no-unused-vars': 'error',
    'no-console': 'warn',
    'no-debugger': 'error',
    'prefer-const': 'error',
    'no-var': 'error',
    'object-shorthand': 'error',
    'prefer-template': 'error',
    'no-useless-escape': 'off'
  },
  overrides: [
    {
      files: ['*.test.js', '*.test.ts', '*.test.jsx', '*.test.tsx'],
      env: {
        jest: true
      },
      rules: {
        'no-console': 'off'
      }
    }
  ]
};
```

### 4. Prettier 配置

```json
// .prettierrc
{
  "semi": true,
  "trailingComma": "es5",
  "singleQuote": true,
  "printWidth": 80,
  "tabWidth": 2,
  "useTabs": false,
  "bracketSpacing": true,
  "arrowParens": "avoid",
  "endOfLine": "lf"
}
```

### 5. Git Hooks 配置 (Husky + Lint-staged)

```javascript
// lint-staged.config.js
module.exports = {
  '*.{js,jsx,ts,tsx}': ['eslint --fix', 'prettier --write'],
  '*.{css,scss,less}': ['stylelint --fix', 'prettier --write'],
  '*.{json,md}': ['prettier --write']
};
```

### 6. 组件库设计示例

```jsx
// src/components/Button/Button.jsx
import React from 'react';
import PropTypes from 'prop-types';
import './Button.scss';

const Button = ({ 
  children, 
  type = 'default', 
  size = 'medium', 
  disabled = false, 
  loading = false, 
  icon, 
  onClick,
  className = '',
  ...props 
}) => {
  const classes = [
    'ui-button',
    `ui-button--${type}`,
    `ui-button--${size}`,
    disabled ? 'ui-button--disabled' : '',
    loading ? 'ui-button--loading' : '',
    className
  ].filter(Boolean).join(' ');

  const handleClick = (e) => {
    if (disabled || loading) {
      e.preventDefault();
      return;
    }
    onClick && onClick(e);
  };

  return (
    <button 
      className={classes} 
      disabled={disabled || loading}
      onClick={handleClick}
      {...props}
    >
      {loading && <span className="ui-button__loading-icon">↻</span>}
      {icon && <span className="ui-button__icon">{icon}</span>}
      <span className="ui-button__text">{children}</span>
    </button>
  );
};

Button.propTypes = {
  children: PropTypes.node.isRequired,
  type: PropTypes.oneOf(['default', 'primary', 'secondary', 'danger', 'link']),
  size: PropTypes.oneOf(['small', 'medium', 'large']),
  disabled: PropTypes.bool,
  loading: PropTypes.bool,
  icon: PropTypes.node,
  onClick: PropTypes.func
};

export default Button;
```

### 7. 状态管理设计 (Redux Toolkit)

```javascript
// src/store/userSlice.js
import { createSlice, createAsyncThunk } from '@reduxjs/toolkit';
import { fetchUserById, updateUserProfile } from '../api/userApi';

// 异步请求用户信息
export const fetchUser = createAsyncThunk(
  'user/fetchUser',
  async (userId, { rejectWithValue }) => {
    try {
      const response = await fetchUserById(userId);
      return response.data;
    } catch (error) {
      return rejectWithValue(error.response.data);
    }
  }
);

// 异步更新用户信息
export const updateProfile = createAsyncThunk(
  'user/updateProfile',
  async (userData, { rejectWithValue }) => {
    try {
      const response = await updateUserProfile(userData);
      return response.data;
    } catch (error) {
      return rejectWithValue(error.response.data);
    }
  }
);

const userSlice = createSlice({
  name: 'user',
  initialState: {
    profile: null,
    loading: false,
    error: null,
    isAuthenticated: false
  },
  reducers: {
    logout: (state) => {
      state.profile = null;
      state.isAuthenticated = false;
      state.loading = false;
      state.error = null;
    }
  },
  extraReducers: (builder) => {
    builder
      .addCase(fetchUser.pending, (state) => {
        state.loading = true;
        state.error = null;
      })
      .addCase(fetchUser.fulfilled, (state, action) => {
        state.loading = false;
        state.profile = action.payload;
        state.isAuthenticated = true;
      })
      .addCase(fetchUser.rejected, (state, action) => {
        state.loading = false;
        state.error = action.payload;
      })
      .addCase(updateProfile.fulfilled, (state, action) => {
        state.profile = { ...state.profile, ...action.payload };
      });
  }
});

export const { logout } = userSlice.actions;
export default userSlice.reducer;
```

### 8. API 管理设计

```javascript
// src/api/request.js
import axios from 'axios';

// 创建 axios 实例
const apiClient = axios.create({
  baseURL: process.env.REACT_APP_API_BASE_URL || '/api',
  timeout: 10000,
  headers: {
    'Content-Type': 'application/json'
  }
});

// 请求拦截器
apiClient.interceptors.request.use(
  (config) => {
    // 添加认证 token
    const token = localStorage.getItem('token');
    if (token) {
      config.headers.Authorization = `Bearer ${token}`;
    }
    
    // 添加请求时间戳，防止缓存
    if (config.method === 'get') {
      config.params = {
        ...config.params,
        _t: Date.now()
      };
    }
    
    return config;
  },
  (error) => {
    return Promise.reject(error);
  }
);

// 响应拦截器
apiClient.interceptors.response.use(
  (response) => {
    return response.data;
  },
  (error) => {
    if (error.response?.status === 401) {
      // 未授权，跳转到登录页
      localStorage.removeItem('token');
      window.location.href = '/login';
    }
    
    if (error.response?.status >= 500) {
      console.error('服务器错误:', error.message);
    }
    
    return Promise.reject(error);
  }
);

export default apiClient;
```

### 9. 测试配置示例

```javascript
// jest.config.js
module.exports = {
  testEnvironment: 'jsdom',
  setupFilesAfterEnv: ['<rootDir>/src/setupTests.js'],
  moduleNameMapping: {
    '^@/(.*)$': '<rootDir>/src/$1',
    '^@components/(.*)$': '<rootDir>/src/components/$1',
    '^@utils/(.*)$': '<rootDir>/src/utils/$1'
  },
  testPathIgnorePatterns: ['/node_modules/', '/build/'],
  collectCoverageFrom: [
    'src/**/*.{js,jsx,ts,tsx}',
    '!src/index.js',
    '!src/reportWebVitals.js'
  ],
  coverageThreshold: {
    global: {
      branches: 80,
      functions: 80,
      lines: 80,
      statements: 80
    }
  }
};
```

### 10. 综合基建配置示例

```javascript
// src/config/index.js
const config = {
  // API 配置
  api: {
    baseUrl: process.env.REACT_APP_API_BASE_URL || 'http://localhost:8080/api',
    timeout: 10000
  },
  
  // 应用配置
  app: {
    name: process.env.REACT_APP_NAME || 'Frontend App',
    version: process.env.REACT_APP_VERSION || '1.0.0',
    environment: process.env.NODE_ENV || 'development'
  },
  
  // 功能开关
  features: {
    enableAnalytics: process.env.REACT_APP_ENABLE_ANALYTICS === 'true',
    enableMock: process.env.REACT_APP_ENABLE_MOCK === 'true',
    enableDebug: process.env.NODE_ENV === 'development'
  },
  
  // 第三方服务配置
  services: {
    sentry: {
      dsn: process.env.REACT_APP_SENTRY_DSN
    },
    googleAnalytics: {
      trackingId: process.env.REACT_APP_GA_ID
    }
  }
};

export default config;
```

## 实际应用场景

### 1. 大型项目开发
在大型前端项目中，基建提供了标准化的开发流程，确保团队成员遵循统一的规范和最佳实践。

### 2. 多项目复用
通过基建的标准化，可以在多个项目中复用相同的工具链和配置，提高开发效率。

### 3. 团队协作
基建中的代码规范和检查工具确保了代码质量，减少了代码审查中的争议。

### 4. 性能优化
基建中的构建优化配置能够显著提升应用的加载速度和运行性能。

## 注意事项

1. **渐进式搭建**：不要试图一次性完成所有基建，应该根据项目需求逐步完善
2. **团队共识**：基建的选择需要团队达成共识，确保所有成员都能适应
3. **维护成本**：基建需要持续维护和更新，要考虑长期的维护成本
4. **性能平衡**：基建工具不应该过度影响开发体验和构建速度
5. **文档完善**：为基建编写完善的文档，方便新成员快速上手

前端基建是一个持续演进的过程，需要根据项目发展和团队需求不断优化和调整。

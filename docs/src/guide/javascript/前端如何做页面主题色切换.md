# å‰ç«¯å¦‚ä½•åšé¡µé¢ä¸»é¢˜è‰²åˆ‡æ¢ï¼Ÿï¼ˆäº†è§£ï¼‰

**é¢˜ç›®**: å‰ç«¯å¦‚ä½•åšé¡µé¢ä¸»é¢˜è‰²åˆ‡æ¢ï¼Ÿï¼ˆäº†è§£ï¼‰

**ç­”æ¡ˆ**:

å‰ç«¯å®ç°é¡µé¢ä¸»é¢˜è‰²åˆ‡æ¢æœ‰å¤šç§æ–¹æ³•ï¼Œä»¥ä¸‹æ˜¯å‡ ç§å¸¸è§çš„å®ç°æ–¹æ¡ˆï¼š

## 1. CSS å˜é‡æ–¹æ¡ˆ

ä½¿ç”¨ CSS è‡ªå®šä¹‰å±æ€§å®ç°ä¸»é¢˜åˆ‡æ¢ï¼š

```css
/* å®šä¹‰ä¸»é¢˜å˜é‡ */
:root {
  --primary-color: #007bff;
  --secondary-color: #6c757d;
  --background-color: #ffffff;
  --text-color: #333333;
  --border-color: #dee2e6;
}

/* æš—è‰²ä¸»é¢˜ */
[data-theme="dark"] {
  --primary-color: #0d6efd;
  --secondary-color: #6c757d;
  --background-color: #121212;
  --text-color: #f8f9fa;
  --border-color: #495057;
}

/* ä½¿ç”¨ä¸»é¢˜å˜é‡ */
.button {
  background-color: var(--primary-color);
  color: var(--text-color);
  border: 1px solid var(--border-color);
}

.container {
  background-color: var(--background-color);
  color: var(--text-color);
}
```

```javascript
// ä¸»é¢˜åˆ‡æ¢åŠŸèƒ½
function switchTheme(themeName) {
  document.documentElement.setAttribute('data-theme', themeName);
  localStorage.setItem('theme', themeName);
}

// æ£€æŸ¥ç³»ç»Ÿåå¥½è®¾ç½®
function getSystemTheme() {
  return window.matchMedia('(prefers-color-scheme: dark)').matches ? 'dark' : 'light';
}

// åˆå§‹åŒ–ä¸»é¢˜
function initTheme() {
  const savedTheme = localStorage.getItem('theme');
  const systemTheme = getSystemTheme();
  const defaultTheme = savedTheme || systemTheme || 'light';
  
  switchTheme(defaultTheme);
}

// ç›‘å¬ç³»ç»Ÿä¸»é¢˜å˜åŒ–
window.matchMedia('(prefers-color-scheme: dark)').addEventListener('change', e => {
  const currentTheme = document.documentElement.getAttribute('data-theme');
  if (!localStorage.getItem('theme')) {
    switchTheme(e.matches ? 'dark' : 'light');
  }
});
```

## 2. React ä¸­ä½¿ç”¨ Context å®ç°ä¸»é¢˜ç®¡ç†

```jsx
import React, { createContext, useContext, useState, useEffect } from 'react';

// å®šä¹‰ä¸»é¢˜
const themes = {
  light: {
    primary: '#007bff',
    secondary: '#6c757d',
    background: '#ffffff',
    text: '#333333',
    border: '#dee2e6'
  },
  dark: {
    primary: '#0d6efd',
    secondary: '#6c757d',
    background: '#121212',
    text: '#f8f9fa',
    border: '#495057'
  }
};

// åˆ›å»ºä¸»é¢˜ä¸Šä¸‹æ–‡
const ThemeContext = createContext();

// ä¸»é¢˜æä¾›è€…ç»„ä»¶
export const ThemeProvider = ({ children }) => {
  const [theme, setTheme] = useState('light');

  useEffect(() => {
    const savedTheme = localStorage.getItem('theme');
    const systemTheme = window.matchMedia('(prefers-color-scheme: dark)')
      .matches ? 'dark' : 'light';
    const initialTheme = savedTheme || systemTheme;
    setTheme(initialTheme);
  }, []);

  useEffect(() => {
    document.documentElement.setAttribute('data-theme', theme);
    localStorage.setItem('theme', theme);
  }, [theme]);

  const toggleTheme = () => {
    setTheme(prev => prev === 'light' ? 'dark' : 'light');
  };

  const value = {
    theme,
    toggleTheme,
    themeColors: themes[theme],
    setTheme
  };

  return (
    <ThemeContext.Provider value={value}>
      {children}
    </ThemeContext.Provider>
  );
};

// ä½¿ç”¨ä¸»é¢˜çš„ Hook
export const useTheme = () => {
  const context = useContext(ThemeContext);
  if (!context) {
    throw new Error('useTheme must be used within a ThemeProvider');
  }
  return context;
};

// ä¸»é¢˜åˆ‡æ¢ç»„ä»¶
export const ThemeToggle = () => {
  const { theme, toggleTheme } = useTheme();
  
  return (
    <button onClick={toggleTheme}>
      {theme === 'light' ? 'ğŸŒ™' : 'â˜€ï¸'}
    </button>
  );
};
```

```jsx
// ä½¿ç”¨ä¸»é¢˜çš„ç»„ä»¶
import React from 'react';
import { useTheme } from './theme-context';

const MyComponent = () => {
  const { themeColors } = useTheme();
  
  const styles = {
    container: {
      backgroundColor: themeColors.background,
      color: themeColors.text,
      padding: '20px',
      borderRadius: '8px'
    },
    button: {
      backgroundColor: themeColors.primary,
      color: '#fff',
      border: `1px solid ${themeColors.border}`,
      padding: '8px 16px',
      borderRadius: '4px'
    }
  };
  
  return (
    <div style={styles.container}>
      <h2>ä¸»é¢˜åˆ‡æ¢ç¤ºä¾‹</h2>
      <button style={styles.button}>æŒ‰é’®</button>
    </div>
  );
};
```

## 3. ä½¿ç”¨ CSS-in-JS å®ç°ä¸»é¢˜

```jsx
import { ThemeProvider, createGlobalStyle } from 'styled-components';

const lightTheme = {
  primary: '#007bff',
  secondary: '#6c757d',
  background: '#ffffff',
  text: '#333333',
  border: '#dee2e6'
};

const darkTheme = {
  primary: '#0d6efd',
  secondary: '#6c757d',
  background: '#121212',
  text: '#f8f9fa',
  border: '#495057'
};

const GlobalStyles = createGlobalStyle`
  body {
    background-color: ${props => props.theme.background};
    color: ${props => props.theme.text};
    transition: background-color, color 0.3s ease;
  }
`;

const ThemedButton = styled.button`
  background-color: ${props => props.theme.primary};
  color: white;
  border: 1px solid ${props => props.theme.border};
  padding: 10px 20px;
  border-radius: 4px;
  cursor: pointer;
  
  &:hover {
    opacity: 0.8;
  }
`;
```

## 4. åŠ¨æ€ä¸»é¢˜åˆ‡æ¢ç±»åæ–¹æ¡ˆ

```javascript
class ThemeManager {
  constructor() {
    this.themes = {
      light: {
        '--primary-color': '#007bff',
        '--secondary-color': '#6c757d',
        '--background-color': '#ffffff',
        '--text-color': '#333333'
      },
      dark: {
        '--primary-color': '#0d6efd',
        '--secondary-color': '#6c757d',
        '--background-color': '#121212',
        '--text-color': '#f8f9fa'
      }
    };
    
    this.currentTheme = this.getStoredTheme() || this.getSystemTheme();
    this.applyTheme(this.currentTheme);
  }
  
  getSystemTheme() {
    return window.matchMedia('(prefers-color-scheme: dark)').matches ? 'dark' : 'light';
  }
  
  getStoredTheme() {
    return localStorage.getItem('theme');
  }
  
  applyTheme(themeName) {
    if (!this.themes[themeName]) return;
    
    const root = document.documentElement;
    const theme = this.themes[themeName];
    
    // è®¾ç½® CSS å˜é‡
    Object.keys(theme).forEach(property => {
      root.style.setProperty(property, theme[property]);
    });
    
    // æ·»åŠ ä¸»é¢˜ç±»å
    root.className = root.className.replace(/theme-\w+/g, '');
    root.classList.add(`theme-${themeName}`);
    
    this.currentTheme = themeName;
    localStorage.setItem('theme', themeName);
  }
  
  toggleTheme() {
    const newTheme = this.currentTheme === 'light' ? 'dark' : 'light';
    this.applyTheme(newTheme);
  }
  
  getCurrentTheme() {
    return this.currentTheme;
  }
}

// åˆå§‹åŒ–ä¸»é¢˜ç®¡ç†å™¨
const themeManager = new ThemeManager();
```

## 5. é¢„åŠ è½½ä¸»é¢˜èµ„æº

```javascript
// é¢„åŠ è½½ä¸»é¢˜ç›¸å…³èµ„æº
function preloadThemeResources(themeName) {
  // é¢„åŠ è½½ä¸»é¢˜ç›¸å…³çš„å›¾ç‰‡
  const themeImages = [
    `./assets/images/${themeName}/background.jpg`,
    `./assets/images/${themeName}/logo.svg`
  ];
  
  themeImages.forEach(src => {
    const img = new Image();
    img.src = src;
  });
  
  // é¢„åŠ è½½ä¸»é¢˜å­—ä½“
  if (themeName === 'dark') {
    const link = document.createElement('link');
    link.rel = 'preload';
    link.as = 'font';
    link.href = './fonts/dark-theme-font.woff2';
    link.type = 'font/woff2';
    link.crossOrigin = 'anonymous';
    document.head.appendChild(link);
  }
}

// ä¸»é¢˜åˆ‡æ¢æ—¶é¢„åŠ è½½èµ„æº
function switchThemeWithPreload(themeName) {
  preloadThemeResources(themeName);
  themeManager.applyTheme(themeName);
}
```

## 6. æ¸å˜åŠ¨ç”»ä¸»é¢˜åˆ‡æ¢

```css
/* æ·»åŠ ä¸»é¢˜åˆ‡æ¢åŠ¨ç”» */
:root {
  transition: background-color 0.3s ease, color 0.3s ease;
}

/* ä¸ºç‰¹å®šå…ƒç´ æ·»åŠ è¿‡æ¸¡æ•ˆæœ */
.theme-transition {
  transition: all 0.3s ease;
}
```

```javascript
// å¸¦æœ‰åŠ¨ç”»çš„ä¸»é¢˜åˆ‡æ¢
function smoothThemeSwitch(newTheme) {
  const body = document.body;
  
  // æ·»åŠ æ·¡å‡ºç±»
  body.classList.add('theme-transition');
  body.style.opacity = '0.5';
  
  setTimeout(() => {
    themeManager.applyTheme(newTheme);
    
    // æ¢å¤é€æ˜åº¦
    body.style.opacity = '1';
  }, 150);
}
```

## 7. ä¸»é¢˜æŒä¹…åŒ–å’ŒåŒæ­¥

```javascript
// è·¨æ ‡ç­¾é¡µåŒæ­¥ä¸»é¢˜è®¾ç½®
window.addEventListener('storage', (e) => {
  if (e.key === 'theme' && e.newValue !== e.oldValue) {
    themeManager.applyTheme(e.newValue);
  }
});

// æœåŠ¡ç«¯ä¸»é¢˜åŒæ­¥
async function syncThemeWithServer(themeName) {
  try {
    await fetch('/api/user/theme', {
      method: 'PUT',
      headers: {
        'Content-Type': 'application/json',
      },
      body: JSON.stringify({ theme: themeName }),
    });
  } catch (error) {
    console.error('Failed to sync theme with server:', error);
  }
}
```

## å…³é”®è¦ç‚¹

1. **CSS å˜é‡**ï¼šæœ€çµæ´»ä¸”æ€§èƒ½å¥½çš„æ–¹æ¡ˆ
2. **æŒä¹…åŒ–**ï¼šä½¿ç”¨ localStorage ä¿å­˜ç”¨æˆ·é€‰æ‹©çš„ä¸»é¢˜
3. **ç³»ç»Ÿåå¥½**ï¼šè€ƒè™‘ç”¨æˆ·çš„ç³»ç»Ÿä¸»é¢˜è®¾ç½®
4. **æ€§èƒ½ä¼˜åŒ–**ï¼šé¿å…é¢‘ç¹çš„æ ·å¼é‡è®¡ç®—
5. **æ— éšœç¢**ï¼šç¡®ä¿ä¸»é¢˜åˆ‡æ¢ä¸å½±å“å¯è®¿é—®æ€§
6. **åŠ¨ç”»æ•ˆæœ**ï¼šæ·»åŠ å¹³æ»‘çš„è¿‡æ¸¡åŠ¨ç”»æå‡ç”¨æˆ·ä½“éªŒ

è¿™äº›æ–¹æ¡ˆå¯ä»¥æ ¹æ®é¡¹ç›®éœ€æ±‚å’Œå¤æ‚åº¦é€‰æ‹©ä½¿ç”¨ï¼Œä»ç®€å•çš„ CSS å˜é‡åˆ°å¤æ‚çš„ä¸»é¢˜ç®¡ç†ç³»ç»Ÿéƒ½æœ‰ç›¸åº”çš„å®ç°æ–¹å¼ã€‚

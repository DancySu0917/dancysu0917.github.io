# 单点登录是什么，具体流程是什么？（了解）

**题目**: 单点登录是什么，具体流程是什么？（了解）

## 单点登录（SSO）概述

单点登录（Single Sign-On，SSO）是一种身份验证机制，允许用户使用一组凭据（如用户名和密码）登录一次后，就可以访问多个相互信任的应用系统，而无需重复登录。

## 核心概念

- **一次登录，多处访问**：用户只需登录一次，即可访问所有相互信任的应用系统
- **身份验证中心**：通常有一个中央认证服务器管理用户身份
- **信任关系**：各应用系统与认证中心建立信任关系

## SSO的主要实现方式

### 1. 基于Cookie + Session的SSO

#### 流程：
1. 用户访问应用系统A
2. 应用系统A检查用户是否已登录（检查Session）
3. 若未登录，重定向到SSO认证中心
4. 用户在认证中心登录
5. 认证中心创建全局Session，并返回Ticket给用户
6. 用户携带Ticket访问应用系统A
7. 应用系统A向认证中心验证Ticket
8. 认证中心验证成功后，应用系统A创建本地Session
9. 用户后续访问其他应用系统B、C时，重复步骤7-8

### 2. 基于Token的SSO（如JWT）

#### 流程：
1. 用户登录认证中心
2. 认证中心验证用户身份后生成JWT Token
3. 用户访问应用系统时携带Token
4. 应用系统验证Token的有效性
5. 验证通过后允许访问

### 3. SAML（Security Assertion Markup Language）

基于XML的开源标准，主要用于企业级SSO。

### 4. OAuth 2.0 / OpenID Connect

- OAuth 2.0：授权框架
- OpenID Connect：基于OAuth 2.0的身份验证层

## 具体实现流程（以Cookie + Session为例）

```
用户访问系统A
        ↓
系统A检查Session → 未登录
        ↓
重定向到SSO认证中心
        ↓
用户输入凭据登录
        ↓
认证中心验证凭据 → 成功
        ↓
认证中心创建全局Session
        ↓
返回Ticket给用户
        ↓
用户携带Ticket访问系统A
        ↓
系统A验证Ticket（向认证中心）
        ↓
认证中心确认Ticket有效
        ↓
系统A创建本地Session
        ↓
用户成功访问系统A
```

## 技术实现要点

### 1. 共享Cookie域
- 需要将认证中心和各个应用系统设置在同一个父域名下
- 例如：sso.example.com, app1.example.com, app2.example.com

### 2. Session同步机制
- 使用分布式Session存储（如Redis）
- 或者使用Token机制避免Session同步

### 3. 安全考虑
- Ticket/Tokens需要加密
- 防止CSRF攻击
- 设置合适的过期时间
- 使用HTTPS传输

## 优势

1. **用户体验好**：一次登录，多处访问
2. **管理便捷**：集中管理用户身份
3. **安全性高**：统一的安全策略
4. **降低维护成本**：减少重复的身份验证逻辑

## 劣势

1. **单点故障**：认证中心故障会影响所有系统
2. **安全风险集中**：一旦认证中心被攻破，所有系统都受影响
3. **复杂性增加**：系统间需要建立信任关系

## 应用场景

- 企业内部系统集成
- 多产品线的互联网公司
- 云服务提供商
- 教育机构的多个在线系统

## 代码示例（简化版）

```javascript
// SSO认证中心伪代码
app.post('/login', (req, res) => {
  const { username, password } = req.body;
  
  // 验证用户凭据
  if (validateCredentials(username, password)) {
    // 创建全局Session
    const sessionId = generateSessionId();
    const ticket = generateTicket(sessionId);
    
    // 存储Session信息
    sessionStore.set(sessionId, { username, loginTime: Date.now() });
    
    // 返回Ticket
    res.json({ ticket, success: true });
  } else {
    res.json({ success: false, message: 'Invalid credentials' });
  }
});

// 应用系统验证Ticket
app.get('/verify', (req, res) => {
  const { ticket } = req.query;
  
  // 验证Ticket
  const sessionId = verifyTicket(ticket);
  if (sessionId && sessionStore.get(sessionId)) {
    res.json({ valid: true, userInfo: sessionStore.get(sessionId) });
  } else {
    res.json({ valid: false });
  }
});
```

单点登录是现代企业级应用中的重要技术，它在提高用户体验的同时，也带来了系统架构上的复杂性，需要在安全性和便利性之间找到平衡。

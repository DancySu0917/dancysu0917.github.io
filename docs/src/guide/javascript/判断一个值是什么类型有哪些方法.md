# 判断一个值是什么类型有哪些方法？（必会）

**题目**: 判断一个值是什么类型有哪些方法？（必会）

**答案**:

在 JavaScript 中，有多种方法可以判断一个值的类型。每种方法都有其适用场景和局限性。

### 1. typeof 操作符

`typeof` 是最常用的方法，可以检测基本数据类型，但对对象类型的区分有限。

```javascript
console.log(typeof undefined);    // "undefined"
console.log(typeof null);         // "object" (历史遗留 bug)
console.log(typeof true);         // "boolean"
console.log(typeof 123);          // "number"
console.log(typeof "hello");      // "string"
console.log(typeof Symbol());     // "symbol"
console.log(typeof BigInt(1));    // "bigint"
console.log(typeof function(){}); // "function"
console.log(typeof {});           // "object"
console.log(typeof []);           // "object"
console.log(typeof new Date());   // "object"
console.log(typeof /regex/);      // "object"
```

### 2. instanceof 操作符

`instanceof` 用于检测对象是否是某个构造函数的实例。

```javascript
// 基本类型不能用 instanceof 检测（基本类型不是对象）
// console.log(123 instanceof Number); // false

// 对象类型
console.log(new String("hello") instanceof String);  // true
console.log(new Number(123) instanceof Number);      // true
console.log(new Boolean(true) instanceof Boolean);   // true
console.log([] instanceof Array);                    // true
console.log(new Date() instanceof Date);             // true
console.log(/regex/ instanceof RegExp);              // true
console.log(function(){} instanceof Function);       // true

// 继承关系
console.log([] instanceof Object);                   // true
console.log(new Date() instanceof Object);           // true
```

### 3. Object.prototype.toString.call()

这是最准确的类型检测方法，可以精确区分各种类型。

```javascript
function getType(value) {
    return Object.prototype.toString.call(value).slice(8, -1);
}

console.log(getType(undefined));     // "Undefined"
console.log(getType(null));          // "Null"
console.log(getType(true));          // "Boolean"
console.log(getType(123));           // "Number"
console.log(getType("hello"));       // "String"
console.log(getType(Symbol()));      // "Symbol"
console.log(getType(BigInt(1)));     // "BigInt"
console.log(getType({}));            // "Object"
console.log(getType([]));            // "Array"
console.log(getType(new Date()));    // "Date"
console.log(getType(/regex/));       // "RegExp"
console.log(getType(function(){}));  // "Function"
console.log(getType(new Error()));   // "Error"
console.log(getType(new Map()));     // "Map"
console.log(getType(new Set()));     // "Set"
console.log(getType(new WeakMap())); // "WeakMap"
console.log(getType(new WeakSet())); // "WeakSet"
```

### 4. Array.isArray()

专门用于检测数组类型，解决了 `typeof` 对数组检测的问题。

```javascript
console.log(Array.isArray([]));        // true
console.log(Array.isArray({}));        // false
console.log(Array.isArray("array"));   // false
console.log(typeof []);                // "object" (typeof 无法区分数组)
console.log(Array.isArray(new Array())); // true
```

### 5. constructor 属性

通过对象的 constructor 属性来判断类型。

```javascript
console.log((123).constructor === Number);        // true
console.log(("hello").constructor === String);    // true
console.log((true).constructor === Boolean);      // true
console.log([].constructor === Array);            // true
console.log(new Date().constructor === Date);     // true
console.log(/regex/.constructor === RegExp);      // true

// 注意：constructor 可能被修改，不够可靠
let arr = [];
arr.constructor = String;
console.log(arr.constructor === Array);           // false (被修改后不准确)
```

### 6. 特定类型的检测函数

对于特定类型，可以使用专门的检测方法：

```javascript
// 检测函数
function isFunction(value) {
    return typeof value === 'function';
}

// 检测数组
function isArray(value) {
    return Array.isArray(value);
}

// 检测日期对象
function isDate(value) {
    return value instanceof Date && !isNaN(value);
}

// 检测正则表达式
function isRegExp(value) {
    return value instanceof RegExp;
}

// 检测错误对象
function isError(value) {
    return value instanceof Error;
}

// 检测 NaN
function isNaNValue(value) {
    return value !== value;  // NaN 是唯一不等于自身的值
}

// 检测有限数字
function isFiniteNumber(value) {
    return typeof value === 'number' && isFinite(value);
}

console.log(isFunction(function(){}));     // true
console.log(isArray([1, 2, 3]));          // true
console.log(isDate(new Date()));          // true
console.log(isRegExp(/abc/));             // true
console.log(isError(new Error()));        // true
console.log(isNaNValue(NaN));             // true
console.log(isFiniteNumber(123));         // true
console.log(isFiniteNumber(Infinity));    // false
```

### 7. 综合类型检测函数

```javascript
function getTypeDetail(value) {
    // 处理 null 和 undefined
    if (value == null) {
        return value + ''; // null -> "null", undefined -> "undefined"
    }
    
    // 处理基本类型
    if (typeof value !== 'object') {
        return typeof value;
    }
    
    // 使用 toString 方法处理对象类型
    return Object.prototype.toString.call(value).slice(8, -1).toLowerCase();
}

// 测试
console.log(getTypeDetail(null));          // "null"
console.log(getTypeDetail(undefined));     // "undefined"
console.log(getTypeDetail(123));           // "number"
console.log(getTypeDetail("hello"));       // "string"
console.log(getTypeDetail(true));          // "boolean"
console.log(getTypeDetail({}));            // "object"
console.log(getTypeDetail([]));            // "array"
console.log(getTypeDetail(new Date()));    // "date"
```

### 8. 各方法的比较和使用场景

| 方法 | 优点 | 缺点 | 适用场景 |
|------|------|------|----------|
| typeof | 简单快速 | 无法区分对象类型，null 问题 | 检测基本类型 |
| instanceof | 可以检测继承关系 | 跨框架时失效 | 检测对象实例 |
| toString | 精确可靠 | 写法稍复杂 | 需要精确类型信息 |
| Array.isArray | 专门针对数组 | 仅适用数组 | 检测数组 |

### 9. 实际应用示例

```javascript
// 类型安全的求和函数
function safeSum(a, b) {
    if (typeof a !== 'number' || typeof b !== 'number') {
        throw new Error('参数必须是数字类型');
    }
    if (isNaN(a) || isNaN(b)) {
        throw new Error('参数不能是 NaN');
    }
    return a + b;
}

// 通用类型检查工具
class TypeChecker {
    static isString(value) {
        return Object.prototype.toString.call(value) === '[object String]';
    }
    
    static isNumber(value) {
        return Object.prototype.toString.call(value) === '[object Number]' && !isNaN(value);
    }
    
    static isPlainObject(value) {
        return Object.prototype.toString.call(value) === '[object Object]';
    }
    
    static isEmpty(value) {
        if (value == null) return true;
        if (this.isString(value) || Array.isArray(value)) return value.length === 0;
        if (this.isPlainObject(value)) return Object.keys(value).length === 0;
        return false;
    }
}

// 使用示例
console.log(TypeChecker.isString("hello"));     // true
console.log(TypeChecker.isNumber(123));         // true
console.log(TypeChecker.isPlainObject({}));     // true
console.log(TypeChecker.isEmpty([]));           // true
console.log(TypeChecker.isEmpty({}));           // true
```

在实际开发中，选择合适的类型检测方法取决于具体需求。对于基本类型检测，`typeof` 通常足够；对于复杂类型检测，推荐使用 `Object.prototype.toString.call()` 方法。

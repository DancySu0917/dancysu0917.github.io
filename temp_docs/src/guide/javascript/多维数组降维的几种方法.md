# 多维数组降维的几种方法（必会）

**题目**: 多维数组降维的几种方法（必会）

## 答案

在JavaScript中，有多种方法可以将多维数组降维（扁平化）为一维数组。以下是常用的方法：

### 1. Array.prototype.flat() 方法（ES2019）

这是最直接的数组扁平化方法，可以指定深度。

```javascript
// 基本用法
const arr = [1, [2, 3], [4, [5, 6]]];
console.log(arr.flat()); // [1, 2, 3, 4, [5, 6]]

// 指定深度
console.log(arr.flat(2)); // [1, 2, 3, 4, 5, 6]

// 完全扁平化（无穷深度）
const deepArr = [1, [2, [3, [4, [5]]]]];
console.log(deepArr.flat(Infinity)); // [1, 2, 3, 4, 5]
```

### 2. Array.prototype.reduce() + concat()

使用reduce方法递归地将数组元素连接起来。

```javascript
function flatten(arr) {
    return arr.reduce((acc, val) => 
        Array.isArray(val) ? acc.concat(flatten(val)) : acc.concat(val), []);
}

const arr = [1, [2, 3], [4, [5, 6]]];
console.log(flatten(arr)); // [1, 2, 3, 4, 5, 6]

// 简化版本（只处理一层）
const arr1 = [1, [2, 3], [4, 5]];
const flattened = arr1.reduce((acc, val) => acc.concat(val), []);
console.log(flattened); // [1, 2, 3, 4, 5]
```

### 3. 扩展运算符（Spread Operator）+ concat()

使用扩展运算符将嵌套数组展开。

```javascript
const arr = [1, [2, 3], [4, 5]];
const flattened = [].concat(...arr);
console.log(flattened); // [1, 2, 3, 4, 5]

// 处理多层嵌套（需要多次应用）
const deepArr = [1, [2, [3, 4]], [5, 6]];
const flattened1 = [].concat(...deepArr); // [1, 2, [3, 4], 5, 6]
const flattened2 = [].concat(...flattened1); // [1, 2, 3, 4, 5, 6]
```

### 4. for...of 循环

使用循环遍历数组元素，递归处理嵌套数组。

```javascript
function flatten(arr) {
    const result = [];
    for (const item of arr) {
        if (Array.isArray(item)) {
            result.push(...flatten(item));
        } else {
            result.push(item);
        }
    }
    return result;
}

const arr = [1, [2, 3], [4, [5, 6]]];
console.log(flatten(arr)); // [1, 2, 3, 4, 5, 6]
```

### 5. Array.prototype.forEach()

使用forEach方法遍历数组并构建新数组。

```javascript
function flatten(arr) {
    const result = [];
    arr.forEach(item => {
        if (Array.isArray(item)) {
            result.push(...flatten(item));
        } else {
            result.push(item);
        }
    });
    return result;
}

const arr = [1, [2, 3], [4, [5, 6]]];
console.log(flatten(arr)); // [1, 2, 3, 4, 5, 6]
```

### 6. toString() + split() 方法

将数组转换为字符串再分割，但这种方法会改变数据类型。

```javascript
const arr = [1, [2, 3], [4, 5]];
const flattened = arr.toString().split(',').map(Number);
console.log(flattened); // [1, 2, 3, 4, 5]

// 注意：这种方法会将所有元素转换为字符串再转换为数字
// 如果数组包含非数字元素，可能产生问题
const mixedArr = [1, ['a', 'b'], [true, false]];
const flattenedMixed = mixedArr.toString().split(',');
console.log(flattenedMixed); // ['1', 'a', 'b', 'true', 'false']
```

### 7. 使用 Array.prototype.flatMap()

flatMap() 方法首先使用映射函数映射每个元素，然后将结果扁平化。

```javascript
const arr = [[1, 2], [3, 4], [5, 6]];
const flattened = arr.flatMap(x => x);
console.log(flattened); // [1, 2, 3, 4, 5, 6]

// 结合映射操作
const numbers = [[1, 2], [3, 4], [5, 6]];
const doubled = numbers.flatMap(x => x.map(n => n * 2));
console.log(doubled); // [2, 4, 6, 8, 10, 12]
```

### 性能和使用建议

1. **Array.flat()**: 最简洁，但需要考虑浏览器兼容性
2. **reduce + concat**: 通用性好，兼容性佳
3. **扩展运算符**: 语法简洁，但需要处理嵌套深度
4. **递归方法**: 灵活，但要注意栈溢出风险

### 实际应用场景

```javascript
// 处理嵌套的分类数据
const categories = [
    ['Electronics', ['Phones', 'Laptops']],
    ['Clothing', ['Shirts', 'Pants']],
    ['Books', ['Fiction', 'Non-fiction']]
];

const flatCategories = categories.flat(Infinity);
console.log(flatCategories); // ['Electronics', 'Phones', 'Laptops', 'Clothing', 'Shirts', 'Pants', 'Books', 'Fiction', 'Non-fiction']
```

选择哪种方法取决于具体需求、嵌套深度和浏览器兼容性要求。
